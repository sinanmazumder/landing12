var SearchProvider=(function(){var companyID=20099;var groupID=20126;var basicAuth,serverName,apiURL;var serverNameLive='www.kwsp.gov.my';var basicAuthLive='';var serverNameDev='kwsp.igndev.com';var basicAuthDev='';var default_lang="en_US";var lang=$("html").attr('lang');lang=lang.replace("-","_");var _dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var _monthNames=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];if(lang.toLowerCase()=='in_id'||lang.toLowerCase()=='ms_my'){_dayNames=['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'];_monthNames=['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogo','Sep','Okt','Nov','Dis']}
var _init=function(){var tmpUrl=window.location.href;if(tmpUrl.indexOf('kwsp.igndev.com')>-1){basicAuth=basicAuthDev;serverName=serverNameDev}else{basicAuth=basicAuthLive;serverName=serverNameLive}
serverName='//'+serverName;basicAuth='Basic '+basicAuth;apiURL=serverName+'/api/jsonws/invoke';var dimsite=$('.dim');var dimsite2=$('.dim2');var searchParam=_getUrlVars();var keyword=searchParam.q;var rt=$('#search-result');if(rt){rt.html('0 result found')}
if(keyword!=''&&keyword!=undefined){_searchContent(keyword)}
$('#btnSearchX').on('click',function(event){console.log('Search button clicked...');event.preventDefault();event.stopPropagation();$('.search-field').toggleClass('expand-search');dimsite2.fadeOut('medium');if($('.search-field').hasClass('expand-search')){$('.search-field').focus();$('#menus').css('z-index','0');dimsite2.fadeIn('medium');dimsite2.on('click',function(){event.preventDefault();event.stopPropagation();dimsite2.fadeOut('medium');$('.search-field').removeClass('expand-search')});$('.hasropdown').hover(function(){dimsite.hide()})}else{$('#menus').css('z-index','50')}});$('#btnSearchMobileX').on('click',function(){var keyword=$('#txtSearchMobile').val();if(keyword!=''){document.location.href='/search?q='+keyword}});$('#btnSearchBanner').on('click',function(){var keyword=$('#search-banner').val();if(keyword!=''){document.location.href='/search?q='+keyword}});$('#search-banner').keypress(function(e){if(e.which==13){var keyword=$('#search-banner').val();if(keyword!=''){document.location.href='/search?q='+keyword}}});$('#txtSearchInput, #search-keyword').keypress(function(e){if(e.which==13){var keyword=$(this).val();if(keyword!=''){document.location.href='/search?q='+keyword}}});$('#test-search').on('click',function(){var searchKeyword=$('#test-search-keyword').val();var postData={'$article = /journal.journalarticle/search':{'companyId':companyID,'groupId':groupID,'folderIds':['41986','41988'],'classNameId':'0','keywords':searchKeyword,'-version':'','ddmStructureKey':'BASIC-WEB-CONTENT','ddmTemplateKey':'BASIC-WEB-CONTENT','-displayDateGT':'','-displayDateLT':'','status':'0','-reviewDate':'','start':'0','end':'100000','-obc':null,'$articleContent = /journal.journalarticle/get-article-content':{'@groupId':'$article.groupId','@articleId':'$article.articleId','languageId':'en_us','-themeDisplay':null},'$latestArticle = /journal.journalarticle/get-latest-article':{'@groupId':'$article.groupId','@articleId':'$article.articleId','status':'0'}}};$.ajax({url:apiURL+'/api/jsonws/invoke',type:'POST',dataType:'json',data:'cmd='+escape(JSON.stringify(postData))+'&p_auth=SQEDtWGB',success:function(response){console.log(response)},beforeSend:function(xhr){}})})};var _search=function(){var keyword=$('#search-banner').val();if(keyword!=''){document.location.href='/search?q='+keyword}};var _getUrlVars=function(){var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');for(var i=0;i<hashes.length;i++){hash=hashes[i].split('=');vars.push(hash[0]);vars[hash[0]]=hash[1]}
return vars};var _searchContentX=function(keyword){Liferay.authToken='SQEDtWGB';Liferay.Service('/journal.journalarticle/search',{'companyId':companyID,'groupId':groupID,'folderIds':[41986,41988,41990,41992,41994,57975,57977,57979],'classNameId':0,'keywords':keyword,'-version':'','ddmStructureKey':'BASIC-WEB-CONTENT','ddmTemplateKey':'BASIC-WEB-CONTENT','-displayDateGT':'','-displayDateLT':'','status':0,'-reviewDate':'','start':0,'end':100000,'-obc':''},function(obj){console.log(obj)})};var _getSearchCount=function(keyword){var postData={'$articleCount = /journal.journalarticle/search-count':{'companyId':companyID,'groupId':groupID,'folderIds':['41986','41988','41990','41992','41994','57975','57977','57979','57975','59725','59727','60202','60280','60362','60499'],'classNameId':'0','keywords':keyword,'-version':'','ddmStructureKey':'52908','ddmTemplateKey':'52912','-displayDateGT':'','-displayDateLT':'','status':'0','-reviewDate':''}};$.ajax({url:apiURL+'/api/jsonws/invoke',type:'POST',dataType:'json',data:'cmd='+escape(JSON.stringify(postData))+'&p_auth=gYSAPEkX',beforeSend:function(xhr){},success:function(response){console.log('Search count = '+response)},error:function(ex){console.log(ex)},complete:function(){}})};var _searchContent=function(keyword){keyword=decodeURIComponent(keyword);keyword=unescape(keyword);$('#txtSearchInput, #search-keyword').val(keyword);keyword=keyword.replace(/\*/g,'\\*');keyword=keyword.replace(/\?/g,'\\?');keyword=keyword.replace(/\!/g,'\\!');keyword=keyword.replace(/\./g,'\\.');keyword=keyword.replace(/\(/g,'');keyword=keyword.replace(/\)/g,'');keyword=keyword.replace(/\'/g,'');keyword=keyword.replace(/\"/g,'');keyword=keyword.replace(/\`/g,'');keyword=keyword.replace(/\+/g,' ');var postData={'/journal.journalfolder/get-folders':{'groupId':groupID}};$.ajax({url:apiURL,type:'POST',dataType:'json',data:'cmd='+escape(JSON.stringify(postData))+'&p_auth=t8g375tQ',beforeSend:function(xhr){},success:function(resFolders){var folderIDs=[];var tmpFolders=[];if(resFolders){var regex=/\s+/g;$.each(resFolders,function(key,value1){var searchFor='banners home latest-updates offices kiosks third-party-kiosks';var tmpName=value1.name.toString().toLowerCase();tmpName=tmpName.replace(regex,'-');if(searchFor.indexOf(tmpName)<0){var folderStatus=parseInt(value1.status);if(folderStatus==0){folderIDs.push(parseInt(value1.folderId));tmpFolders.push({id:value1.folderId,name:value1.name,status:folderStatus})}}})}
var tmpKeyword=keyword.replace(/\+/g,' ');console.log('Keyword => ',tmpKeyword);postData={'/journal.journalarticle/search':{'companyId':companyID,'groupId':groupID,'folderIds':folderIDs,'classNameId':'0','keywords':tmpKeyword,'-version':'','-ddmStructureKey':'','-ddmTemplateKey':'','-displayDateGT':'','-displayDateLT':'','status':'0','-reviewDate':'','start':'0','end':'10000','-obc':''}};var overlay=$('<div id="loading-overlay" style="position: absolute;width: 100%;height: 100%;z-index: 1000;background-color: rgba(0,0,0,0.3);top: 0;left: 0;"><i class="fa fa-spinner fa-spin fa-4x" style="color: #f5f5f5;margin: 0 auto;position: relative;top: calc(50% - 32px);left: calc(50% - 32px);"></i></div>')
$('html,body').append(overlay);$.ajax({url:apiURL,type:'POST',dataType:'json',data:'cmd='+JSON.stringify(postData)+'&p_auth=SQEDtWGB',beforeSend:function(xhr){},success:function(response){var splitKeyword=decodeURIComponent(keyword).split(' ');var regExpPattern=new RegExp('('+keyword+')','gi');var pagingParam=_getUrlVars();var totalResults=response.length;var pageCount=Math.ceil(totalResults/10);var offset=0;var searchTitle='Search Result';if(pagingParam.offset!=''&&pagingParam.offset!=undefined){offset=parseInt(pagingParam.offset)}
response.sort(sortByNameDesc('modifiedDate'));$('#loading-overlay').remove();var resultContainer=$('#search-result-items-container');resultContainer.empty();var startFrom=0;var endTo=0;startFrom=offset*10;endTo=startFrom+10;if(endTo>totalResults)endTo=totalResults;var contentFields='contentPageTitle contentLinkToPage contentHeaderSmall contentHeaderTextLarge contentHeaderDescription contentHeaderExtraInfo contentHeaderImage contentBody';var contentFieldsNewsHighlights='Category Title shortDescription genDate';var searchResults=[];var totalRelevance=0;$.each(response,function(key,value){var article=value;var searchResult={title:null,description:null,linkURL:null,linkText:null,modifiedDate:article.modifiedDate,numOfOccurance:0};try{var xml=$.parseXML(article.content);var articleTitle='';var articleDescription='';var articleBody='';var articleLinkText='';var articleLinkHref='';var articleModifiedDate;var numOfOccurance=0;var genDate='';var newsHighlightLink=article.urlTitle;var tmpDate=new Date(article.modifiedDate);articleModifiedDate=_dayNames[tmpDate.getDay()]+', '+tmpDate.getDate()+' '+_monthNames[tmpDate.getMonth()]+' '+tmpDate.getFullYear();if(xml){var node=xml.childNodes[0];$.each(node.childNodes,function(key,value){if(value.nodeName=='dynamic-element'){var fieldName=value.attributes.name.nodeValue;if(contentFields.indexOf(fieldName)>-1){$.each(value.childNodes,function(key,value){if(value.nodeName=='dynamic-content'){if(value.attributes['language-id'].nodeValue==lang){if(fieldName=='contentPageTitle')articleTitle=value.textContent;if(fieldName=='contentHeaderDescription')articleDescription=value.textContent;if(fieldName=='contentBody')articleBody=stripHtml(value.textContent);if(fieldName=='contentLinkToPage'){articleLinkText=value.textContent;articleLinkHref=value.textContent}}
if(articleTitle==null){if(value.attributes['language-id'].nodeValue=='en_US'){if(fieldName=='contentPageTitle')articleTitle=value.textContent;if(fieldName=='contentBody')articleBody=stripHtml(value.textContent)}}}})}
if(contentFieldsNewsHighlights.indexOf(fieldName)>-1){$.each(value.childNodes,function(key,value){if(value.nodeName=='dynamic-content'){if(value.attributes['language-id'].nodeValue==lang){if(fieldName=='Title')articleTitle=value.textContent;if(fieldName=='shortDescription')articleDescription=value.textContent;if(fieldName=='genDate')genDate=value.textContent;if(fieldName=='innerPageContent')articleBody=stripHtml(value.textContent)}
if(articleTitle==null){if(value.attributes['language-id'].nodeValue=='en_US'){if(fieldName=='Title')articleTitle=value.textContent;if(fieldName=='innerPageContent')articleBody=stripHtml(value.textContent)}}}})}}});if(articleTitle!=''){numOfOccurance+=(articleTitle.match(regExpPattern)||[]).length;numOfOccurance+=(articleBody.match(regExpPattern)||[]).length;if(genDate!=''){searchResults.push({title:articleTitle,description:articleDescription,linkURL:'/-/'+newsHighlightLink,linkText:'/-/'+newsHighlightLink,modifiedDate:articleModifiedDate,numOfOccurance:numOfOccurance})}else{searchResults.push({title:articleTitle,description:articleDescription,linkURL:articleLinkHref,linkText:articleLinkText,modifiedDate:articleModifiedDate,numOfOccurance:numOfOccurance})}}}}catch(e){$('#loading-overlay').remove()}});searchResults.sort(sortByNameDesc('numOfOccurance'));var searchResultsCopy=[];var searchResultTitle='';searchResults.forEach(function(item){if(item.title!=searchResultTitle){searchResultsCopy.push(item)}
searchResultTitle=item.title});totalResults=searchResultsCopy.length;var searchResultText=totalResults+' result'+((totalResults>1)?'s':'')+' found';var lastUpdatedText='Last update';var pageText='Page';if(lang.toLowerCase()=='in_id'||lang.toLowerCase()=='ms_my'){searchTitle='Keputusan Carian';searchResultText=totalResults+' laman dijumpai';lastUpdatedText='Kemaskini terakhir';pageText='Muka'}
$('#search-result').prev().html('<h2>'+searchTitle+'</h2>');$('#search-result').html(searchResultText);if(endTo>totalResults)endTo=totalResults;for(var n=startFrom;n<endTo;n++){var searchResult=searchResultsCopy[n];var itemResult='';var m=(parseInt(searchResult.numOfOccurance)/totalRelevance)*100;itemResult+='<div class="cell small-12 headernomargin">';itemResult+=' <h3>'+searchResult.title+'</h3>';itemResult+=' <p class="extra_top10">'+searchResult.description+'<span style="font-style:italic;color:#999;display:block;margin-top:8px;margin-bottom:10px;">'+lastUpdatedText+': '+searchResult.modifiedDate+'</span></p>';var language=lang.toLowerCase();itemResult+=' <a href="/'+language.split('_')[0]+searchResult.linkURL+'" target="_blank" rel="noopener noreferrer">https://www.kwsp.gov.my'+searchResult.linkText+'</a>';itemResult+=' <hr class="grey">';itemResult+='</div>';resultContainer.append(itemResult)}
pageCount=Math.ceil(totalResults/10);var pagination='';pagination+='<br><div class="cell small-12 extra_bottom2">';pagination+=pageText+'&nbsp;&nbsp;&nbsp;&nbsp;';for(var pager=0;pager<pageCount;pager++){var pageLink='';if(pager==offset){pageLink='<span style="font-weight:bold;">'+(pager+1)+'</span>'}else{pageLink='<a href="/search?q='+keyword+'&offset='+pager+'">'+(pager+1)+'</a>'}
pagination+='[&nbsp;'+pageLink+'&nbsp;]&nbsp;&nbsp;&nbsp;'}
pagination+='</div>';resultContainer.append($(pagination))},error:function(ex){$('#loading-overlay').remove();console.log('journal.journalarticle.search => ',ex)},complete:function(){$('#loading-overlay').remove()}})},error:function(ex){console.log('journal.journalfolder.get-folders => ',ex)},complete:function(){}})};var sortByNameDesc=function(prop){return function(a,b){if(a[prop]>b[prop]){return-1}else if(a[prop]<b[prop]){return 1}
return 0}};var sortByNameAsc=function(prop){return function(a,b){if(a[prop]>b[prop]){return 1}else if(a[prop]<b[prop]){return-1}
return 0}};var stripHtml=function(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||''};return{init:_init,search:_search}})()